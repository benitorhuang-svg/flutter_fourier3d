# 規格說明：股市數據獲取與持久化 (Market Data Acquisition) - v2.1

## 概述 (Overview)
本模組是專案的「數據引擎」，負責將外部物理市場的震盪轉化為數位信號。核心亮點在於「預處理計算」——我們不直接存儲原始價格，而是存儲經過頻譜解析後的諧波參數（振幅與相位），這極大地降低了前端在歷史回放時的計算開銷，確保流暢的 3D 體驗。

## 使用者故事 (User Stories)
1. **無感同步**：作為使用者，我希望系統能在背景定期同步數據，且當我切換視覺化模式時，當前的市場動態已經就緒。
2. **數據連貫性**：我希望在歷史回溯時，系統能自動處理非交易時段的空白，提供平滑的時間軸導覽。
3. **高效檢索**：我希望能快速載入特定的「快照 (Snapshot)」，並觀察傅立葉轉換如何解構當下的股價波動。

## 功能性需求 (Functional Requirements)

### 1. 採樣與預處理 (Data Refinement)
*   **端點對接**：精準串接 TWSE 的 `MI_5MINS_INDEX`, `MI_5MINS`, 與 `STOCK_DAY`。
*   **差分運算 (Delta)**：針對累計成交量進行 `V(t) - V(t-1)` 計算，獲取區間動能。
*   **去趨勢處理 (Detrending)**：執行 FFT 前先行移除價格序列均值，消除 DC 偏移。
*   **動態插值**：將變動長度的採樣點統一映射至 `60` 支物理諧波。

### 2. 核心頻譜轉換 (DFT Engine)
*   **頻域分解**：實作離散傅立葉轉換 (DFT)，提取市場走勢的週期項。
*   **參數生成**：生成對應的 `harmonics` (振幅) 與 `phases` (相位) 數據區塊。

### 3. 持久化與同步策略
*   **快照機制**：每次同步生成唯一的資料庫記錄，包含預計算好的 JSON 字串。
*   **冪等性檢查**：基於時間戳記防止重複資料寫入。
*   **Timeline API**：提供獲取最近 N 筆快照元數據的端點供前端渲染 Slider。

## 非功能性需求 (Non-Functional Requirements)
*   **精確度**：頻譜轉換誤差須控制在 0.01% 以內。
*   **回應效能**：API 端點的資料庫查詢應在 200ms 內完成。
*   **離線支援**：具備本地快照緩存，確保在無網路環境下仍能顯示歷史波形。
